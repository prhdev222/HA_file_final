{% extends "base.html" %}

{% block title %}อัปโหลด Guidelines - ระบบจัดการไฟล์แผนกอายุรกรรม{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin_dashboard') }}">แดชบอร์ด</a></li>
                <li class="breadcrumb-item active">อัปโหลด Guidelines</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-upload me-2"></i>อัปโหลดไฟล์ Guidelines
        </h1>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-file-medical me-2"></i>ข้อมูลไฟล์</h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="department_id" class="form-label">หน่วยงาน <span class="text-danger">*</span></label>
                        <select class="form-select" id="department_id" name="department_id" required>
                            <option value="">เลือกหน่วยงาน</option>
                            {% for dept in departments %}
                            <option value="{{ dept.id }}">{{ dept.name }} ({{ dept.code }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="title" class="form-label">ชื่อไฟล์ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="title" name="title" required 
                               placeholder="เช่น: แนวทางการรักษาเบาหวาน 2024">
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">คำอธิบาย</label>
                        <textarea class="form-control" id="description" name="description" rows="3" 
                                  placeholder="อธิบายเนื้อหาของไฟล์นี้"></textarea>
                    </div>
                    
                    <!-- ตัวเลือกประเภทการอัปโหลด -->
                    <div class="mb-3">
                        <label class="form-label">ประเภทการอัปโหลด <span class="text-danger">*</span></label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="upload_type" id="upload_file" value="file" checked>
                            <label class="form-check-label" for="upload_file">
                                <i class="fas fa-file-upload me-2"></i>อัปโหลดไฟล์
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="upload_type" id="upload_link" value="link">
                            <label class="form-check-label" for="upload_link">
                                <i class="fas fa-link me-2"></i>ลิงก์ภายนอก
                            </label>
                        </div>
                    </div>
                    
                    <!-- ส่วนอัปโหลดไฟล์ -->
                    <div id="file_upload_section" class="mb-4">
                        <label for="file" class="form-label">ไฟล์ <span class="text-danger">*</span></label>
                        <input type="file" class="form-control" id="file" name="file" 
                               accept=".pdf,.doc,.docx,.ppt,.pptx">
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            รองรับไฟล์: PDF, DOC, DOCX, PPT, PPTX (ขนาดสูงสุด 50MB)
                        </div>
                    </div>
                    
                    <!-- ส่วนลิงก์ภายนอก -->
                    <div id="link_section" class="mb-4" style="display: none;">
                        <div class="mb-3">
                            <label for="link_type" class="form-label">ประเภทลิงก์</label>
                            <select class="form-select" id="link_type" name="link_type">
                                <option value="">เลือกประเภทลิงก์</option>
                                <option value="Google Drive">Google Drive</option>
                                <option value="OneDrive">OneDrive</option>
                                <option value="Dropbox">Dropbox</option>
                                <option value="Website">เว็บไซต์</option>
                                <option value="Other">อื่นๆ</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="external_link" class="form-label">ลิงก์ <span class="text-danger">*</span></label>
                            <input type="url" class="form-control" id="external_link" name="external_link" 
                                   placeholder="https://drive.google.com/file/d/... หรือ https://example.com/...">
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                ใส่ลิงก์ที่สามารถเข้าถึงได้จากภายนอก
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-upload me-2"></i>อัปโหลดไฟล์
                        </button>
                        <a href="{{ url_for('admin_guidelines') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>กลับไปหน้าจัดการ Guidelines
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- File Upload Guidelines -->
        <div class="card mt-4">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>คำแนะนำการอัปโหลด</h6>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li>ไฟล์ต้องมีขนาดไม่เกิน 50MB</li>
                    <li>รองรับเฉพาะไฟล์เอกสาร: PDF, DOC, DOCX, PPT, PPTX</li>
                    <li>ชื่อไฟล์ควรสื่อความหมายและเข้าใจง่าย</li>
                    <li>กรอกคำอธิบายเพื่อให้ผู้ใช้เข้าใจเนื้อหาได้ดีขึ้น</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// สลับระหว่างส่วนอัปโหลดไฟล์และลิงก์ภายนอก
document.addEventListener('DOMContentLoaded', function() {
    const uploadFileRadio = document.getElementById('upload_file');
    const uploadLinkRadio = document.getElementById('upload_link');
    const fileSection = document.getElementById('file_upload_section');
    const linkSection = document.getElementById('link_section');
    const fileInput = document.getElementById('file');
    const linkInput = document.getElementById('external_link');
    
    function toggleSections() {
        if (uploadFileRadio.checked) {
            fileSection.style.display = 'block';
            linkSection.style.display = 'none';
            fileInput.required = true;
            linkInput.required = false;
        } else {
            fileSection.style.display = 'none';
            linkSection.style.display = 'block';
            fileInput.required = false;
            linkInput.required = true;
        }
    }
    
    uploadFileRadio.addEventListener('change', toggleSections);
    uploadLinkRadio.addEventListener('change', toggleSections);
    
    // เริ่มต้นด้วยการแสดงส่วนอัปโหลดไฟล์
    toggleSections();
});

// ตรวจสอบขนาดไฟล์
document.getElementById('file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const maxSize = 50 * 1024 * 1024; // 50MB
    
    if (file && file.size > maxSize) {
        alert('ไฟล์มีขนาดใหญ่เกินไป (สูงสุด 50MB)');
        this.value = '';
        return;
    }
    
    // ตรวจสอบประเภทไฟล์
    const allowedTypes = [
        'application/pdf',
        'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/vnd.ms-powerpoint',
        'application/vnd.openxmlformats-officedocument.presentationml.presentation'
    ];
    
    if (file && !allowedTypes.includes(file.type)) {
        alert('ประเภทไฟล์ไม่ถูกต้อง กรุณาเลือกไฟล์ PDF, DOC, DOCX, PPT, หรือ PPTX');
        this.value = '';
        return;
    }
});
</script>
{% endblock %}
